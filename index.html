<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>出國地點匿名投票</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f2f2f2;
      margin: 0; padding: 1em;
      max-width: 480px; margin: auto;
    }
    h2 { color: #333; text-align: center; }
    .card {
      background: white;
      border-radius: 10px;
      padding: 1em;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-top: 1em;
    }
    label, select {
      display: block;
      width: 100%;
      margin-top: 10px;
    }
    select {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      width: 100%;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-top: 20px;
    }
    .result {
      background-color: #fff3cd;
      padding: 1em;
      margin-top: 20px;
      border-radius: 8px;
    }
    ol {
      padding-left: 1.2em;
    }
  </style>
</head>
<body>

  <h2>匿名出國投票</h2>

  <div class="card">
    <form id="voteForm">
      <label for="animalCode">選擇你的匿名代號：</label>
      <select id="animalCode" required>
        <option value="">-- 選擇一個動物代號 --</option>
        <option>Panda</option>
        <option>Fox</option>
        <option>Koala</option>
        <option>Tiger</option>
        <option>Rabbit</option>
        <option>Penguin</option>
      </select>

      <p style="margin-top:1em;">請排序你想去的地點：</p>
      <div id="voteFields"></div>

      <button type="submit">送出投票</button>
    </form>
  </div>

  <div class="result" id="resultArea" style="display:none">
    <h3>目前總積分排行：</h3>
    <ol id="rankingList"></ol>
  </div>

  <script>
    const places = ["越南胡志明市", "日本沖繩", "韓國濟州島", "韓國首爾", "香港"];
    const scoreMap = [5, 4, 3, 2, 1];
    const voteFields = document.getElementById("voteFields");

    // 建立地點排序下拉選單
    for (let i = 1; i <= places.length; i++) {
      const div = document.createElement("div");
      div.innerHTML = `
        <label>第 ${i} 名：</label>
        <select name="rank${i}" required>
          <option value="">-- 選擇地點 --</option>
          ${places.map(p => `<option value="${p}">${p}</option>`).join("")}
        </select>`;
      voteFields.appendChild(div);
    }

    const form = document.getElementById("voteForm");
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const animalCode = document.getElementById("animalCode").value;
      if (!animalCode) return alert("請選擇匿名代號！");
      if (localStorage.getItem("voted_" + animalCode)) {
        alert("這個代號已經投過票！");
        return;
      }

      const selected = [];
      for (let i = 1; i <= places.length; i++) {
        const val = form[`rank${i}`].value;
        if (!val || selected.includes(val)) {
          alert("請正確排序，地點不可重複！");
          return;
        }
        selected.push(val);
      }

      let total = JSON.parse(localStorage.getItem("voteTotal") || "{}");
      selected.forEach((place, index) => {
        total[place] = (total[place] || 0) + scoreMap[index];
      });

      localStorage.setItem("voteTotal", JSON.stringify(total));
      localStorage.setItem("voted_" + animalCode, "1");

      alert("✅ 投票完成！");
      form.style.display = "none";
      showResults();
    });

    function showResults() {
      document.getElementById("resultArea").style.display = "block";
      const total = JSON.parse(localStorage.getItem("voteTotal") || "{}");
      const sorted = Object.entries(total).sort((a, b) => b[1] - a[1]);
      const list = document.getElementById("rankingList");
      list.innerHTML = "";
      sorted.forEach(([place, score]) => {
        list.innerHTML += `<li>${place}：${score} 分</li>`;
      });
    }

    // 如果已投票，直接顯示結果
    window.onload = () => {
      const code = document.getElementById("animalCode");
      code.addEventListener("change", () => {
        const val = code.value;
        if (val && localStorage.getItem("voted_" + val)) {
          alert("這個代號已經投票過了！");
          form.style.display = "none";
          showResults();
        }
      });
    };
  </script>

</body>
</html>